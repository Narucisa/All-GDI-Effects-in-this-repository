<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GDI+ Effects in HTML + JS</title>
<style>
  html, body {
    margin: 0;
    overflow: hidden;
    background: black;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener("resize", resize);
resize();

let t = 0;

// ---------- Helper: Hue rotate ----------
function hueRotate(r, g, b, angle) {
  angle *= Math.PI / 180;
  const cosA = Math.cos(angle);
  const sinA = Math.sin(angle);

  return [
    r * (0.213 + cosA * 0.787 - sinA * 0.213) +
    g * (0.715 - cosA * 0.715 - sinA * 0.715) +
    b * (0.072 - cosA * 0.072 + sinA * 0.928),

    r * (0.213 - cosA * 0.213 + sinA * 0.143) +
    g * (0.715 + cosA * 0.285 + sinA * 0.140) +
    b * (0.072 - cosA * 0.072 - sinA * 0.283),

    r * (0.213 - cosA * 0.213 - sinA * 0.787) +
    g * (0.715 - cosA * 0.715 + sinA * 0.715) +
    b * (0.072 + cosA * 0.928 + sinA * 0.072)
  ];
}

// ---------- Draw base ----------
function drawBase() {
  ctx.fillStyle = `rgb(${(t*2)%255},${(t*4)%255},${(t*8)%255})`;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// ---------- GDI-style pixel effects ----------
function applyEffects() {
  const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const d = img.data;

  for (let y = 0; y < canvas.height; y++) {
    for (let x = 0; x < canvas.width; x++) {
      const i = (y * canvas.width + x) * 4;

      let r = d[i];
      let g = d[i + 1];
      let b = d[i + 2];

      // XOR effect (classic GDI demo)
      r ^= (x + t) & 255;
      g ^= (y + t) & 255;
      b ^= (x ^ y ^ t) & 255;

      // Invert
      if ((x + y + t) % 80 < 40) {
        r = 255 - r;
        g = 255 - g;
        b = 255 - b;
      }

      // Hue shift
      [r, g, b] = hueRotate(r, g, b, t % 360);

      d[i]     = r;
      d[i + 1] = g;
      d[i + 2] = b;
    }
  }
  ctx.putImageData(img, 0, 0);
}

// ---------- Wave / BitBlt-style distortion ----------
function wave() {
  ctx.drawImage(
    canvas,
    Math.sin(t * 0.02) * 10,
    Math.cos(t * 0.015) * 10
  );
}

// ---------- Melt effect ----------
function melt() {
  const slice = 2 + (t % 20);
  ctx.drawImage(
    canvas,
    0, slice,
    canvas.width, canvas.height - slice,
    0, 0,
    canvas.width, canvas.height
  );
}

// ---------- Main loop ----------
function loop() {
  t++;

  drawBase();
  applyEffects();

  if (t % 3 === 0) wave();
  if (t % 5 === 0) melt();

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
